var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));import{d as default_1$1}from"./Favorite.js";import{d as default_1,B as Box,H as modifyDocument,a as documents$}from"./documents.js";import*as React from"react";import React__default,{memo,useMemo,useCallback,useRef}from"react";import{combineLatest}from"rxjs";import{map}from"rxjs/operators";import{h as htmdx,I as IconButton,M as MarkdownRenderer}from"./markdown_renderer.js";import{u as useParams,L as Link}from"./doks.js";import{m as generateUtilityClass,n as generateUtilityClasses,o as styled,q as useThemeProps,h as _objectWithoutPropertiesLoose,_ as _extends,r as composeClasses,j as jsx,l as clsx,d as jsxs,F as Fragment}from"./main.js";import{G as Grid}from"./Button.js";import{u as useObservableState,a as useObservable}from"./use-observable-state.js";import{C as Card}from"./Card.js";import{C as CardHeader}from"./CardHeader.js";import"./index.js";import"react-dom";function getCardContentUtilityClass(e){return generateUtilityClass("MuiCardContent",e)}generateUtilityClasses("MuiCardContent",["root"]);const _excluded=["className","component"],useUtilityClasses=e=>{const{classes:t}=e;return composeClasses({root:["root"]},getCardContentUtilityClass,t)},CardContentRoot=styled("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),CardContent=React.forwardRef((function(e,t){const r=useThemeProps({props:e,name:"MuiCardContent"}),{className:o,component:s="div"}=r,a=_objectWithoutPropertiesLoose(r,_excluded),n=_extends({},r,{component:s}),i=useUtilityClasses(n);return jsx(CardContentRoot,_extends({as:s,className:clsx(i.root,o),ownerState:n,ref:t},a))}));var CardContent$1=CardContent;const formatDate=e=>new Date(e).toLocaleString();class ErrorBoundary extends React__default.Component{constructor(e){super(e),this.state={hasError:!1,error:""}}componentDidCatch(e,t){}static getDerivedStateFromError(e){return{hasError:!0,error:e.message}}render(){return this.state.hasError?(console.error("toc error",this.state.error),jsxs(Fragment,{children:[jsx("h1",{children:"MDX error:"}),jsx("div",{children:this.state.error})]})):this.props.children}}const TOCList=default_1("ul")({listStyle:"none",margin:0,padding:10,lineHeight:"1.6em"}),TOCListItem=default_1("li")({fontSize:"1.1em","a,a:hover,a:link,a:active":{color:"inherit",textDecoration:"none"},"a:hover":{textDecoration:"underline"}}),getListItem=e=>t=>{const r=useParams();return jsx(TOCListItem,{sx:{paddingLeft:10*(e-1)+"px"},children:jsx(Link,__spreadProps(__spreadValues({},t),{to:`/${r.projectSlug}/${r.contentSlug}/${t.index}`}))})},TOC=memo((({mdx:e})=>{const t=useMemo((()=>null==e?void 0:e.replace(/(<([^>]+)>)/gi,"").split("\n").filter((e=>e.includes("#"))).join("\n")),[e]);let r=0,o=0;return jsx(Fragment,{children:void 0!==t?jsx(TOCList,{children:htmdx(t,React__default.createElement,{components:{h1:getListItem(1),h2:getListItem(2),h3:getListItem(3),h4:getListItem(4),h6:getListItem(6),h7:getListItem(7),h8:getListItem(8),h10:getListItem(10)},jsxTransforms:[(e,t,s)=>(t||(t={}),e.startsWith("h")&&(t.index=o,o++),t.key=r++,[e,t,s])]})}):jsx(Fragment,{})})})),Wrapper=default_1(Box)((({theme:e})=>__spreadValues({},e.typography.body1))),Header=default_1("h1")({fontSize:"1.2em",fontWeight:"bold"}),TableOfContents=({mdx:e})=>jsxs(Wrapper,{children:[jsx(Header,{children:"Table of contents"}),jsx(ErrorBoundary,{children:jsx(TOC,{mdx:e})},"toc-"+e)]}),ContentWrapper=default_1(Grid)((({theme:e})=>({display:"flex",alignItems:"start",flexDirection:"row",[e.breakpoints.down("sm")]:{maxWidth:"100%",flexBasis:"initial"}}))),Content=()=>{var e;const t=useParams(),r=useObservableState(useObservable((e=>combineLatest(e,documents$).pipe(map((([e,t])=>t.get(e[0].contentSlug))))),[t])),o=useCallback((()=>{modifyDocument(__spreadProps(__spreadValues({},r),{isFavourite:!r.isFavourite}))}),[r]),s=useRef(),a=useCallback((()=>{var e;if(void 0!==t.headingIndex){const r=null==(e=s.current)?void 0:e.querySelector(`#heading-${t.headingIndex}`);if(r){const e=60,t=window.document.body.getBoundingClientRect().top,o=r.getBoundingClientRect().top-t-e;console.log(o),window.scrollTo({top:o,behavior:"smooth"})}}}),[t.headingIndex]);return jsxs(ContentWrapper,{item:!0,xs:9,children:[jsxs(Card,{elevation:2,sx:{padding:2,textAlign:"justify",overflowX:"auto"},children:[r&&jsx(CardHeader,{action:jsx(IconButton,{"aria-label":"favourite",onClick:o,children:jsx(default_1$1,{sx:{color:r.isFavourite&&"red"}})}),title:r.name,subheader:(n=r.lastModified,new Date(n).toLocaleString())}),jsx(CardContent$1,{ref:s,sx:{display:"block",overflow:"auto"},children:jsx(MarkdownRenderer,{mdx:null==r?void 0:r.mdx,onAfterRender:a})})]}),(null==(e=null==r?void 0:r.mdx)?void 0:e.includes("#"))&&jsx(Card,{elevation:2,sx:{padding:2,textAlign:"justify",overflowX:"auto",marginTop:"20px",marginBottom:"20px",marginLeft:"-10px",whiteSpace:"pre",overflow:"visible",position:"sticky",top:"80px"},children:jsx(TableOfContents,{mdx:null==r?void 0:r.mdx})})]});var n};export{Content,Content as default};