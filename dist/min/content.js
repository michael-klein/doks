var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));import{d as default_1$2}from"./Favorite.js";import{c as createSvgIcon,i as interopRequireDefault,r as require$$2,d as default_1$1,B as Box,H as modifyDocument,a as documents$}from"./documents.js";import*as React from"react";import React__default,{memo,useMemo,useCallback,useRef,useEffect}from"react";import{combineLatest}from"rxjs";import{map}from"rxjs/operators";import{h as htmdx,I as IconButton,M as MarkdownRenderer}from"./markdown_renderer.js";import{u as useParams,L as Link}from"./doks.js";import{m as generateUtilityClass,n as generateUtilityClasses,o as styled,q as useThemeProps,h as _objectWithoutPropertiesLoose,_ as _extends,r as composeClasses,j as jsx,l as clsx,d as jsxs,F as Fragment}from"./main.js";import{G as Grid}from"./Button.js";import{u as useObservableState,a as useObservable}from"./use-observable-state.js";import{C as Card}from"./Card.js";import{C as CardHeader}from"./CardHeader.js";import"./index.js";import"react-dom";function getCardContentUtilityClass(e){return generateUtilityClass("MuiCardContent",e)}generateUtilityClasses("MuiCardContent",["root"]);const _excluded=["className","component"],useUtilityClasses=e=>{const{classes:t}=e;return composeClasses({root:["root"]},getCardContentUtilityClass,t)},CardContentRoot=styled("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),CardContent=React.forwardRef((function(e,t){const r=useThemeProps({props:e,name:"MuiCardContent"}),{className:o,component:s="div"}=r,a=_objectWithoutPropertiesLoose(r,_excluded),n=_extends({},r,{component:s}),i=useUtilityClasses(n);return jsx(CardContentRoot,_extends({as:s,className:clsx(i.root,o),ownerState:n,ref:t},a))}));var CardContent$1=CardContent;const formatDate=e=>new Date(e).toLocaleString();var SubdirectoryArrowRight={},_interopRequireDefault=interopRequireDefault.exports;Object.defineProperty(SubdirectoryArrowRight,"__esModule",{value:!0});var default_1=SubdirectoryArrowRight.default=void 0,_createSvgIcon=_interopRequireDefault(createSvgIcon),_jsxRuntime=require$$2,_default=(0,_createSvgIcon.default)((0,_jsxRuntime.jsx)("path",{d:"m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9l6 6z"}),"SubdirectoryArrowRight");default_1=SubdirectoryArrowRight.default=_default;class ErrorBoundary extends React__default.Component{constructor(e){super(e),this.state={hasError:!1,error:""}}componentDidCatch(e,t){}static getDerivedStateFromError(e){return{hasError:!0,error:e.message}}render(){return this.state.hasError?(console.error("toc error",this.state.error),jsxs(Fragment,{children:[jsx("h1",{children:"MDX error:"}),jsx("div",{children:this.state.error})]})):this.props.children}}const TOCList=default_1$1("ul")({listStyle:"none",margin:0,padding:10,paddingLeft:0,lineHeight:"1.3em",maxHeight:"calc(60vh)",overflowY:"auto"}),TOCListItem=default_1$1("li")({fontSize:".9em","a,a:hover,a:link,a:active":{color:"inherit",textDecoration:"none",textAlign:"left"},"a:hover":{textDecoration:"underline"}}),getListItem=e=>t=>{const r=useParams();return jsxs(TOCListItem,{sx:{marginLeft:10*(e-1)+"px"},children:[jsx(default_1,{sx:{fontSize:".8em",marginRight:".2em"},className:"sub-icon"}),jsx(Link,__spreadProps(__spreadValues({},t),{to:`/docs/${r.projectSlug}/${r.contentSlug}/${t.index}`}))]})},TOC=memo((({mdx:e})=>{const t=useMemo((()=>null==e?void 0:e.replace(/(<([^>]+)>)/gi,"").split("\n").filter((e=>e.includes("#"))).join("\n")),[e]);let r=0,o=0;return jsx(Fragment,{children:void 0!==t?jsx(TOCList,{children:htmdx(t,React__default.createElement,{components:{h1:getListItem(1),h2:getListItem(2),h3:getListItem(3),h4:getListItem(4),h6:getListItem(6),h7:getListItem(7),h8:getListItem(8),h10:getListItem(10)},jsxTransforms:[(e,t,s)=>(t||(t={}),e.startsWith("h")&&(t.index=o,o++),t.key=r++,[e,t,s])]})}):jsx(Fragment,{})})})),Wrapper=default_1$1(Box)((({theme:e})=>__spreadProps(__spreadValues({},e.typography.body1),{width:"220px"}))),Header=default_1$1("h1")({fontSize:"1em",marginBottom:"-.7em",fontWeight:"bold"}),TableOfContents=({mdx:e})=>jsxs(Wrapper,{children:[jsx(Header,{children:"Table of contents"}),jsx(ErrorBoundary,{children:jsx(TOC,{mdx:e})},"toc-"+e)]}),ContentWrapper=default_1$1(Grid)((({theme:e})=>({display:"flex",alignItems:"start",flexDirection:"row",[e.breakpoints.down("sm")]:{maxWidth:"100%",flexBasis:"initial"}}))),Content=()=>{var e;const t=useParams(),r=useObservableState(useObservable((e=>combineLatest(e,documents$).pipe(map((([e,t])=>t.get(e[0].contentSlug))))),[t])),o=useCallback((()=>{modifyDocument(__spreadProps(__spreadValues({},r),{isFavourite:!r.isFavourite}))}),[r]),s=useRef(),a=useRef(),n=useCallback((()=>{var e;if(void 0!==t.headingIndex){const r=null==(e=s.current)?void 0:e.querySelector(`#heading-${t.headingIndex}`);r&&(clearTimeout(a.current),a.current=setInterval((()=>{requestAnimationFrame((()=>{const e=window.document.body.getBoundingClientRect().top,t=r.getBoundingClientRect().top-e-60;t>0&&(window.scrollTo({top:t,behavior:"smooth"}),clearTimeout(a.current))}))}),100))}}),[t.headingIndex]);return useEffect((()=>(window.scrollTo(0,0),()=>{clearTimeout(a.current)})),[t.contentSlug]),jsxs(ContentWrapper,{item:!0,xs:9,children:[jsxs(Card,{elevation:2,sx:{padding:2,textAlign:"justify",overflowX:"auto"},children:[r&&jsx(CardHeader,{action:jsx(IconButton,{"aria-label":"favourite",onClick:o,children:jsx(default_1$2,{sx:{color:r.isFavourite&&"red"}})}),title:r.name,subheader:(i=r.lastModified,new Date(i).toLocaleString())}),jsx(CardContent$1,{ref:s,sx:{display:"block",overflow:"auto"},children:jsx(MarkdownRenderer,{mdx:null==r?void 0:r.mdx,onAfterRender:n})})]}),((null==(e=null==r?void 0:r.mdx)?void 0:e.match(/#/g))||[]).length>1&&jsx(Card,{elevation:2,sx:{textAlign:"justify",overflowX:"auto",marginTop:"20px",marginBottom:"20px",marginLeft:"-10px",overflow:"visible",position:"sticky",padding:"10px",paddingRight:0,top:"100px"},children:jsx(TableOfContents,{mdx:null==r?void 0:r.mdx})})]});var i};export{Content,Content as default};